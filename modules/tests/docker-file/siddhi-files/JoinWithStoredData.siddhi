@App:name("JoinWithStoredData")

@App:description('Join streaming data with data stored in an RDBMS table')

@PrimaryKey("creditCardNo")
define table FraudTable (creditCardNo string);

@source(type='http', @map(type='json'))
define stream TradeStream(creditCardNo string, trader string, tradeInfo string);

@sink(type='log')
define stream SuspiciousTradeStream(creditCardNo string, suspiciousTrader string, suspiciousInfoTrade string);

from TradeStream
select creditCardNo
insert into FraudTable;

--Perform a join on credit card number, to capture transactions with credit cards that have previously been used for fraudulent activity
@info(name='query1')
from TradeStream as t join FraudTable as f
    on t.creditCardNo == f.creditCardNo
select t.creditCardNo, t.trader as suspiciousTrader, t.tradeInfo as suspiciousInfoTrade
insert into SuspiciousTradeStream;












